<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossbar Array Measurement Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Crossbar Array Measurement Tracker</h1>
            <p class="subtitle">Track ferroelectric diode measurements</p>
            <div id="connectionStatus" class="connection-status disconnected">
                <span class="status-dot"></span>
                <span id="statusText">Connecting...</span>
            </div>
        </header>

        <div class="controls">
            <div class="control-group">
                <h3>Create New Entry</h3>
                <input type="text" id="entryName" placeholder="e.g., Wafer-A-Nov-7-2024">
                <select id="arraySize">
                    <option value="8">8x8 Array</option>
                    <option value="128">128x128 Array (2kB)</option>
                </select>
                <button id="createEntry" class="btn-primary">Create New Entry</button>
            </div>

            <div class="control-group">
                <h3>Existing Entries</h3>
                <select id="entrySelector" size="5">
                    <option value="">No entries yet</option>
                </select>
                <div class="entry-buttons">
                    <button id="loadEntry" class="btn-secondary">Load Entry</button>
                    <button id="deleteEntry" class="btn-danger">Delete Entry</button>
                </div>
            </div>
        </div>

        <div id="currentEntry" class="current-entry" style="display: none;">
            <div class="entry-header">
                <h2 id="currentEntryName"></h2>
                <p id="currentArraySize"></p>
            </div>

            <div class="stats-panel">
                <h3>Statistics</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">Total Devices:</span>
                        <span id="totalDevices" class="stat-value">0</span>
                    </div>
                    <div class="stat-item success">
                        <span class="stat-label">✓ Successful:</span>
                        <span id="successCount" class="stat-value">0</span>
                        <span class="stat-percent" id="successPercent">(0%)</span>
                    </div>
                    <div class="stat-item failed">
                        <span class="stat-label">✗ Failed:</span>
                        <span id="failedCount" class="stat-value">0</span>
                        <span class="stat-percent" id="failedPercent">(0%)</span>
                    </div>
                    <div class="stat-item warning">
                        <span class="stat-label">⚠ Misaligned:</span>
                        <span id="warningCount" class="stat-value">0</span>
                        <span class="stat-percent" id="warningPercent">(0%)</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Unmeasured:</span>
                        <span id="unmeasuredCount" class="stat-value">0</span>
                        <span class="stat-percent" id="unmeasuredPercent">(0%)</span>
                    </div>
                </div>
                <button id="exportData" class="btn-secondary">Export Data (JSON)</button>
                <button id="importData" class="btn-secondary">Import from JSON</button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
                <button id="exportImage" class="btn-secondary">Export as PNG</button>
                <button id="clearAll" class="btn-danger">Clear All Measurements</button>
            </div>

            <div class="legend">
                <h4>Legend & Keyboard Controls:</h4>
                <div class="legend-items">
                    <div class="legend-item"><span class="legend-box empty"></span> Unmeasured</div>
                    <div class="legend-item"><span class="legend-box success"></span> Successful</div>
                    <div class="legend-item"><span class="legend-box failed"></span> Failed</div>
                    <div class="legend-item"><span class="legend-box warning"></span> Misaligned</div>
                </div>
                <p class="hint" style="margin-top: 10px;">
                    <strong>Tip:</strong> Click a cell to select it, then use arrow keys (↑↓←→) to navigate and Space to mark devices. Hover to see when each cell was last changed!
                </p>
            </div>

            <div class="quick-nav">
                <h4>Quick Navigate (for 2kB arrays)</h4>
                <div class="coord-inputs">
                    <div class="input-group">
                        <label for="bottomElectrode">Bottom Electrode (B):</label>
                        <input type="number" id="bottomElectrode" min="0" max="127" placeholder="0-127">
                    </div>
                    <div class="input-group">
                        <label for="topElectrode">Top Electrode (T):</label>
                        <input type="number" id="topElectrode" min="0" max="127" placeholder="0-127">
                    </div>
                    <button id="goToDevice" class="btn-secondary">Go to Device</button>
                    <button id="cycleDevice" class="btn-primary">Mark Device</button>
                </div>
                <p class="hint">Press Enter in either field to jump to device, or click "Mark Device" to cycle its state</p>
            </div>

            <div class="sharing-info">
                <h4>Real-Time Collaboration</h4>
                <p>All changes are automatically synchronized in real-time across all users. Just share this URL with your advisor:</p>
                <p><strong>https://krishkc5.github.io/crossbar-measurement-tracker/</strong></p>
                <p class="note">Note: You can also export data as JSON or PNG for backup and offline analysis.</p>
            </div>

            <div class="grid-container">
                <div id="crossbarGrid"></div>
            </div>
        </div>
    </div>

    <!-- Hover tooltip for device coordinates -->
    <div id="deviceTooltip" class="device-tooltip" style="display: none;">
        <div class="tooltip-coords"></div>
        <div class="tooltip-preview"></div>
    </div>

    <!-- Firebase SDK for real-time sync -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="script.js"></script>
</body>
</html>
